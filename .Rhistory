# 0. 載入必要的函式庫
library(tidyverse) # 包含 dplyr 和 ggplot2
library(readr)
library(VIM) # 用於 KNN 填補
library(pscl) # 用於 Pseudo R-squared (McFadden)
library(caTools) # 用於資料分割
)
)
brfss_positions <- list(
c(316, 317), # Cancer
c(146, 146), # Depression
c(313, 315), # Age told had cancer
c(72, 72), # Gender
c(623, 624), # Race
c(2090, 2090), # Income
c(186, 187), # Education
c(107, 109), # Health insurance
c(1401, 1402), # Urban rural
c(2097, 2098), # Binge drinking
c(224, 225), # Ever smoking
c(2086, 2087), # Obese
c(112, 113), # Exercise in Past 30 Days
c(113, 115), # Type of Physical Activity 1
c(115, 118), # Physical Activity Frequency 1
c(121, 123), # Type of Physical Activity 2
c(123, 126), # Physical Activity Frequency 2
c(129, 132), # Anaerobic exercise time
c(133, 134), # Hypertension
c(136, 137), # Dyslipidemia
c(137, 138), # Heart attack
c(138, 139), # Coronary heart disease
c(148, 149) # Diabetes
)
column_names <- c(
"cancer",
"depression",
"age_told_had_cancer",
"gender",
"race",
"income",
"education",
"health_insurance",
"urban_rural",
"binge_drinking",
"ever_smoking",
"obese",
"exercise_past_30_days",
"physical_activity_type_1",
"physical_activity_frequency_1",
"physical_activity_type_2",
"physical_activity_frequency_2",
"anaerobic_exercise_time",
"hypertension",
"dyslipidemia",
"heart_attack",
"Coronary_heart_disease",
"diabetes"
)
if (length(brfss_positions) != length(column_names)) {
stop("錯誤: `brfss_positions` 和 `column_names` 的長度不匹配。請檢查定義。")
}
col_specs_named <- fwf_positions(
start = sapply(brfss_positions, `[`, 1),
end = sapply(brfss_positions, `[`, 2),
col_names = column_names
)
# 2. 載入原始數據
cat("--- 2. 載入原始數據 ---\n")
brfss_data <- tryCatch(
{
read_fwf(
file = data_path,
col_positions = col_specs_named,
col_types = paste(rep("c", length(column_names)), collapse = "")
)
},
error = function(e) {
stop(paste("讀取檔案時發生錯誤，請檢查檔案路徑和權限：", e$message))
}
)
data_path <- "C:\Users\chee1\repository\BRFSS-breast-cancer-depression"
# 0. 載入必要的函式庫
library(tidyverse) # 包含 dplyr 和 ggplot2
library(readr)
library(VIM) # 用於 KNN 填補
library(pscl) # 用於 Pseudo R-squared (McFadden)
library(caTools) # 用於資料分割
cat("--- 開始偵錯程序 ---\n\n")
# 1. 資料路徑和設定
# data_path <- "C:/Users/XPG/Desktop/BRFSS_Analysis/data/LLCP2023.ASC"
data_path <- "C:\Users\chee1\repository\BRFSS-breast-cancer-depression"
# 0. 載入必要的函式庫
library(tidyverse) # 包含 dplyr 和 ggplot2
library(readr)
library(VIM) # 用於 KNN 填補
library(pscl) # 用於 Pseudo R-squared (McFadden)
library(caTools) # 用於資料分割
cat("--- 開始偵錯程序 ---\n\n")
# 1. 資料路徑和設定
# data_path <- "C:/Users/XPG/Desktop/BRFSS_Analysis/data/LLCP2023.ASC"
data_path <- "C:/Users/chee1/repository/BRFSS-breast-cancer-depression"
# 根據您原始 Python 程式碼的 (start, end) 定義列位置
brfss_positions <- list(
c(316, 317), # Cancer
c(146, 146), # Depression
c(313, 315), # Age told had cancer
c(72, 72), # Gender
c(623, 624), # Race
c(2090, 2090), # Income
c(186, 187), # Education
c(107, 109), # Health insurance
c(1401, 1402), # Urban rural
c(2097, 2098), # Binge drinking
c(224, 225), # Ever smoking
c(2086, 2087), # Obese
c(112, 113), # Exercise in Past 30 Days
c(113, 115), # Type of Physical Activity 1
c(115, 118), # Physical Activity Frequency 1
c(121, 123), # Type of Physical Activity 2
c(123, 126), # Physical Activity Frequency 2
c(129, 132), # Anaerobic exercise time
c(133, 134), # Hypertension
c(136, 137), # Dyslipidemia
c(137, 138), # Heart attack
c(138, 139), # Coronary heart disease
c(148, 149) # Diabetes
)
column_names <- c(
"cancer",
"depression",
"age_told_had_cancer",
"gender",
"race",
"income",
"education",
"health_insurance",
"urban_rural",
"binge_drinking",
"ever_smoking",
"obese",
"exercise_past_30_days",
"physical_activity_type_1",
"physical_activity_frequency_1",
"physical_activity_type_2",
"physical_activity_frequency_2",
"anaerobic_exercise_time",
"hypertension",
"dyslipidemia",
"heart_attack",
"Coronary_heart_disease",
"diabetes"
)
if (length(brfss_positions) != length(column_names)) {
stop("錯誤: `brfss_positions` 和 `column_names` 的長度不匹配。請檢查定義。")
}
col_specs_named <- fwf_positions(
start = sapply(brfss_positions, `[`, 1),
end = sapply(brfss_positions, `[`, 2),
col_names = column_names
)
# 2. 載入原始數據
cat("--- 2. 載入原始數據 ---\n")
brfss_data <- tryCatch(
{
read_fwf(
file = data_path,
col_positions = col_specs_named,
col_types = paste(rep("c", length(column_names)), collapse = "")
)
},
error = function(e) {
stop(paste("讀取檔案時發生錯誤，請檢查檔案路徑和權限：", e$message))
}
)
source("C:/Users/chee1/repository/BRFSS-breast-cancer-depression/dummy_encoding.R")
View(breast_cancer_data)
# Remove the 'race' column as it is not needed for further analysis
breast_cancer_data <- breast_cancer_data %>%
select(-race)
# Set income 77 and 99 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(income = ifelse(income %in% c(77, 99), NA, income))
unique(breast_cancer_data$income)
# Set income 1 to 7 to 0 to 6
breast_cancer_data <- breast_cancer_data %>%
mutate(income = ifelse(income >= 1 & income <= 7, income - 1, income))
unique(breast_cancer_data$income)
source("C:/Users/chee1/repository/BRFSS-breast-cancer-depression/dummy_encoding.R")
View(breast_cancer_data)
unique(breast_cancer_data$income)
View(breast_cancer_data)
source("C:/Users/chee1/repository/BRFSS-breast-cancer-depression/dummy_encoding.R")
View(breast_cancer_data)
unique(breast_cancer_data$income)
unique(breast_cancer_data$education)
# Set education 9 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(education = ifelse(education == 9, NA, education))
# Set education 9 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(education = ifelse(education == 9, NA, education))
unique(breast_cancer_data$education)
# Set income 77 and 99 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(income = ifelse(income %in% c(77, 99), NA, income))
# Set education 9 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(education = ifelse(education == 9, NA, education))
# Set health_insurance 77 and 99 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(health_insurance = ifelse(health_insurance %in% c(77, 99), NA, health_insurance))
# Dummy variables for health insurance 1 ~ 10 and 88
breast_cancer_data <- breast_cancer_data %>%
mutate(
health_insurance_2 = ifelse(health_insurance == 2, 1, 0),
health_insurance_3 = ifelse(health_insurance == 3, 1, 0),
health_insurance_4 = ifelse(health_insurance == 4, 1, 0),
health_insurance_5 = ifelse(health_insurance == 5, 1, 0),
health_insurance_6 = ifelse(health_insurance == 6, 1, 0),
health_insurance_7 = ifelse(health_insurance == 7, 1, 0),
health_insurance_8 = ifelse(health_insurance == 8, 1, 0),
health_insurance_9 = ifelse(health_insurance == 9, 1, 0),
health_insurance_10 = ifelse(health_insurance == 10, 1, 0),
health_insurance_88 = ifelse(health_insurance == 88, 1, 0)
)
View(breast_cancer_data)
unique(breast_cancer_data$urban_rural)
unique(breast_cancer_data$binge_drinking)
# Set ever_smoking 7 and 9 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(ever_smoking = ifelse(ever_smoking %in% c(7, 9), NA, ever_smoking))
View(breast_cancer_data)
unique(breast_cancer_data$ever_smoking)
unique(breast_cancer_data$obese)
# Set exercise_past_30_days 7 and 9 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(exercise_past_30_days = ifelse(exercise_past_30_days %in% c(7, 9), NA, exercise_past_30_days))
unique(breast_cancer_data$exercise_past_30_days)
# Set physical_activity_type_1 77 and 99 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(physical_activity_type_1 = ifelse(physical_activity_type_1 %in% c(77, 99), NA, physical_activity_type_1))
unique(breast_cancer_data$physical_activity_type_1)
# Set physical_activity_type_1 77 and 99 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(physical_activity_type_1 = ifelse(physical_activity_type_1 %in% c(77, 99), NA, physical_activity_type_1))
# Dummy variables for physical activity type 1 from number 1 to 11
breast_cancer_data <- breast_cancer_data %>%
mutate(
physical_activity_type_1_2 = ifelse(physical_activity_type_1 == 2, 1, 0),
physical_activity_type_1_3 = ifelse(physical_activity_type_1 == 3, 1, 0),
physical_activity_type_1_4 = ifelse(physical_activity_type_1 == 4, 1, 0),
physical_activity_type_1_5 = ifelse(physical_activity_type_1 == 5, 1, 0),
physical_activity_type_1_6 = ifelse(physical_activity_type_1 == 6, 1, 0),
physical_activity_type_1_7 = ifelse(physical_activity_type_1 == 7, 1, 0),
physical_activity_type_1_8 = ifelse(physical_activity_type_1 == 8, 1, 0),
physical_activity_type_1_9 = ifelse(physical_activity_type_1 == 9, 1, 0),
physical_activity_type_1_10 = ifelse(physical_activity_type_1 == 10, 1, 0),
physical_activity_type_1_11 = ifelse(physical_activity_type_1 == 11, 1, 0)
)
# Dummy variables for physical activity type 1 from number 1 to 11
breast_cancer_data <- breast_cancer_data %>%
mutate(
physical_activity_type_1_2 = ifelse(physical_activity_type_1 == "02", 1, 0),
physical_activity_type_1_3 = ifelse(physical_activity_type_1 == "03", 1, 0),
physical_activity_type_1_4 = ifelse(physical_activity_type_1 == 4, 1, 0),
physical_activity_type_1_5 = ifelse(physical_activity_type_1 == "05", 1, 0),
physical_activity_type_1_6 = ifelse(physical_activity_type_1 == 6, 1, 0),
physical_activity_type_1_7 = ifelse(physical_activity_type_1 == 7, 1, 0),
physical_activity_type_1_8 = ifelse(physical_activity_type_1 == 8, 1, 0),
physical_activity_type_1_9 = ifelse(physical_activity_type_1 == 9, 1, 0),
physical_activity_type_1_10 = ifelse(physical_activity_type_1 == 10, 1, 0),
physical_activity_type_1_11 = ifelse(physical_activity_type_1 == 11, 1, 0)
)
unique(breast_cancer_data$physical_activity_type_1)
unique(breast_cancer_data$physical_activity_type_1) == "01"
source("C:/Users/chee1/repository/BRFSS-breast-cancer-depression/dummy_encoding.R")
# Remove the 'physical_activity_type_1' column as it is not needed for further analysis
breast_cancer_data <- breast_cancer_data %>%
select(-physical_activity_type_1)
unique(breast_cancer_data$physical_activity_frequency_1)
# Set physical_activity_frequency_1 777 and 999 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(physical_activity_frequency_1 = ifelse(physical_activity_frequency_1 %in% c0("777", "999"), NA, physical_activity_frequency_1))
# Set physical_activity_frequency_1 777 and 999 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(physical_activity_frequency_1 = ifelse(physical_activity_frequency_1 %in% c(777, 999), NA, physical_activity_frequency_1))
unique(breast_cancer_data$physical_activity_frequency_1)
# Set physical_activity_frequency_1 777 and 999 to NA
breast_cancer_data <- breast_cancer_data %>%
mutate(physical_activity_frequency_1 = ifelse(physical_activity_frequency_1 %in% c("777", "999"), NA, physical_activity_frequency_1))
unique(breast_cancer_data$physical_activity_frequency_1)
source("C:/Users/chee1/repository/BRFSS-breast-cancer-depression/dummy_encoding.R")
source("C:/Users/chee1/repository/BRFSS-breast-cancer-depression/dummy_encoding.R")
unique(breast_cancer_data$physical_activity_frequency_1)
# Convert exercise frequency to monthly frequency
# Original coding: 101-199 (times per week), 201-299 (times per month)
# Target: all converted to times per month
breast_cancer_data <- breast_cancer_data %>%
mutate(
# Convert string to numeric first
physical_activity_frequency_1_num = as.numeric(physical_activity_frequency_1),
# Convert to monthly frequency
physical_activity_frequency_1_monthly = case_when(
# Weekly frequency (101-199): subtract 100, then multiply by 4
physical_activity_frequency_1_num >= 101 & physical_activity_frequency_1_num <= 199 ~
(physical_activity_frequency_1_num - 100) * 4,
# Monthly frequency (201-299): subtract 200 to get actual monthly frequency
physical_activity_frequency_1_num >= 201 & physical_activity_frequency_1_num <= 299 ~
physical_activity_frequency_1_num - 200,
)
)
unique(breast_cancer_data$physical_activity_frequency_1)
source("C:/Users/chee1/repository/BRFSS-breast-cancer-depression/dummy_encoding.R")
# Remove the original frequency column and the numeric conversion
breast_cancer_data <- breast_cancer_data %>%
select(-physical_activity_frequency_1, -physical_activity_frequency_1_num)
